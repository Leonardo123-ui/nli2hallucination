# æ”¹è¿›æ–¹æ¡ˆæ€»ç»“ä¸å¯¼èˆª

**ç”Ÿæˆæ—¶é—´**: 2025-12-27
**åˆ†æå¯¹è±¡**: training_model1.log, train_model2.log

---

## ğŸ“Š æ ¸å¿ƒå‘ç°

### ç°çŠ¶è¯„ä¼°
- **Model 1 Macro F1**: 0.5494 (å½“å‰æœ€ä¼˜)
- **Model 2 Macro F1**: 0.5284
- **æ”¹è¿›ç©ºé—´**: å¯è¾¾ 0.58-0.60+ (æå‡ 0.03-0.05)
- **ä¸»è¦ç“¶é¢ˆ**: ç±»åˆ«ä¸å¹³è¡¡å¯¼è‡´çš„å­¦ä¹ å›°éš¾

### å…³é”®é—®é¢˜
| é—®é¢˜ | ç—‡çŠ¶ | æ ¹å›  |
|------|------|------|
| æ—©æœŸå­¦ä¹ å›°éš¾ | å‰ 12 ä¸ª epoch Macro F1 ä¸å˜ | Focal Loss æƒé‡ä¸å½“ |
| é¢„æµ‹åˆ†å¸ƒä¸å¹³è¡¡ | æ— æ³•æ­£ç¡®é¢„æµ‹å°‘æ•°ç±» | alpha=[0.5, 2.0] ä¸è¶³ä»¥é©±åŠ¨å­¦ä¹  |
| æ”¶æ•›é€Ÿåº¦æ…¢ | éœ€è¦ 18-23 ä¸ª epoch | åˆå§‹åŒ–å’Œå­¦ä¹ ç‡é…ç½®ä¸ä¼˜ |

---

## ğŸ“ ç”Ÿæˆæ–‡æ¡£å¯¼èˆª

### 1. **QUICK_START.md** â­ ä»è¿™é‡Œå¼€å§‹
**ä½•æ—¶é˜…è¯»**: ç«‹å³ï¼ˆ5 åˆ†é’Ÿï¼‰
**å†…å®¹**:
- ç«‹å³å¯æ‰§è¡Œçš„ 5 åˆ†é’Ÿæ”¹è¿›æ–¹æ¡ˆ
- 30 åˆ†é’Ÿå®Œæ•´æ”¹è¿›æµç¨‹
- å¸¸è§é—®é¢˜æ’æŸ¥
- ç´§æ€¥æ•‘æ´æ­¥éª¤

**å¿«é€Ÿé“¾æ¥**: ç¬¬ 128 è¡Œä¿®æ”¹ `alpha=[0.5, 2.0]` â†’ `alpha=[1.0, 3.4]`

---

### 2. **IMPROVEMENT_PLAN.md** è¯¦ç»†æ–¹æ¡ˆæ–‡æ¡£
**ä½•æ—¶é˜…è¯»**: ç†è§£å…¨é¢ç­–ç•¥ï¼ˆ30 åˆ†é’Ÿï¼‰
**åŒ…å«å†…å®¹**:

#### A. ä¼˜åŒ–æ•°æ®å’Œç±»åˆ«æƒè¡¡ (ä¼˜å…ˆçº§ â­â­â­â­â­)
- è°ƒæ•´ Focal Loss ç±»åˆ«æƒé‡
- è°ƒæ•´ Gamma å‚æ•°
- è°ƒæ•´ Label Smoothing

#### B. ä¼˜åŒ–åˆå§‹åŒ–å’Œå­¦ä¹ ç‡ (ä¼˜å…ˆçº§ â­â­â­â­)
- æ”¹è¿›æƒé‡åˆå§‹åŒ–
- è°ƒæ•´å­¦ä¹ ç‡ä¸é¢„çƒ­
- åˆ†é˜¶æ®µå­¦ä¹ ç‡ç­–ç•¥

#### C. æ•°æ®å¢å¼ºå’Œé‡‡æ ·ç­–ç•¥ (ä¼˜å…ˆçº§ â­â­â­â­)
- è¿‡é‡‡æ ·å°‘æ•°ç±»
- æ¬ é‡‡æ ·å¤šæ•°ç±»
- æ··åˆé‡‡æ ·ç­–ç•¥ï¼ˆSMOTEï¼‰

#### D. æ¨¡å‹æ¶æ„æ”¹è¿› (ä¼˜å…ˆçº§ â­â­â­)
- æ·»åŠ æ³¨æ„åŠ›æœºåˆ¶
- ArcFace/CosFace æŸå¤±

#### E. è¯„ä¼°æŒ‡æ ‡å’Œç›‘æ§ (ä¼˜å…ˆçº§ â­â­â­â­)
- å¤šç»´åº¦ç›‘æ§æŒ‡æ ‡
- Matthews ç›¸å…³ç³»æ•°

**æ¨èå®éªŒè®¡åˆ’**:
- å®éªŒ 1: æƒé‡ä¼˜åŒ– (2-3 å°æ—¶)
- å®éªŒ 2: å­¦ä¹ ç‡è°ƒåº¦ (1-2 å°æ—¶)
- å®éªŒ 3: æ•°æ®å¹³è¡¡ (3-4 å°æ—¶)
- å®éªŒ 4: ç»¼åˆä¼˜åŒ– (4-6 å°æ—¶)

---

### 3. **ANALYSIS_REPORT.md** æ·±å±‚é—®é¢˜è¯Šæ–­
**ä½•æ—¶é˜…è¯»**: ç†è§£ä¸ºä»€ä¹ˆå‡ºç°è¿™äº›é—®é¢˜ï¼ˆ20 åˆ†é’Ÿï¼‰
**åŒ…å«å†…å®¹**:

#### è¯¦ç»†å¯¹æ¯”åˆ†æ
- Model 1 vs Model 2 çš„åˆæœŸå­¦ä¹ å·®å¼‚
- æ”¶æ•›æ›²çº¿åˆ†æ
- é¢„æµ‹åˆ†å¸ƒæ¼”åŒ–è¿‡ç¨‹
- æ€§èƒ½æŒ‡æ ‡æ·±å±‚åˆ†æ
- æ¢¯åº¦ä¿¡æ¯åˆ†æ

#### æ ¹å› åˆ†æ (5 Why æ³•)
- ä¸ºä»€ä¹ˆ Model 1 å‰ 12 ä¸ª epoch æ— æ³•é¢„æµ‹ Class 1
- ä¸ºä»€ä¹ˆ Model 2 åˆæœŸåå‘å´©æºƒ
- å¦‚ä½•è§£å†³è¿™äº›é—®é¢˜

#### æ”¹è¿›ä¼˜å…ˆçº§çŸ©é˜µ
- æŒ‰å½±å“åº¦å’Œå®ç°éš¾åº¦æ’åº
- æ¸…æ™°çš„ä¼˜å…ˆçº§æŒ‡å¯¼

#### å¿«é€Ÿè¯Šæ–­æ¸…å•
- ç”¨äºè¯„ä¼°æ–°è®­ç»ƒç»“æœçš„æ ‡å‡†

---

### 4. **EXPERIMENT_TEMPLATE.md** å®éªŒæ‰§è¡ŒæŒ‡å—
**ä½•æ—¶é˜…è¯»**: å‡†å¤‡æ‰§è¡Œå®éªŒæ—¶ï¼ˆ15 åˆ†é’Ÿï¼‰
**åŒ…å«å†…å®¹**:

#### å®éªŒ 1: Focal Loss æƒé‡ä¼˜åŒ–
```yaml
4 ä¸ªé…ç½®:
  - [1.0, 3.4]
  - [1.2, 3.0]
  - [1.5, 2.5]
  - [2.0, 2.0]
```

#### å®éªŒ 2: å­¦ä¹ ç‡é¢„çƒ­è°ƒæ•´
```yaml
2 ä¸ªé…ç½®:
  - warmup_steps: 5000
  - warmup_steps: 6000
```

#### å®éªŒ 3: æ•°æ®é‡‡æ ·ç­–ç•¥
```yaml
3 ä¸ªæ–¹æ¡ˆ:
  - ç®€å•è¿‡é‡‡æ ·
  - SMOTE + æ¬ é‡‡æ ·
```

#### å®éªŒ 4: ç»¼åˆä¼˜åŒ–
```yaml
ç»„åˆæœ€ä¼˜é…ç½®:
  - alpha=[1.2, 3.0]
  - warmup_steps=5000
  - SMOTE é‡‡æ ·
```

---

## ğŸ¯ è¡ŒåŠ¨è®¡åˆ’

### ä»Šå¤© (æ¨è)
```
æ—¶é—´: 30 åˆ†é’Ÿ + 1.5 å°æ—¶è®­ç»ƒç­‰å¾…
æ­¥éª¤:
1. è¯» QUICK_START.md (5 min)
2. ä¿®æ”¹ train.py ç¬¬ 128 è¡Œ (2 min)
3. å¯åŠ¨è®­ç»ƒ (1 min)
4. ç­‰å¾…å®Œæˆ... (1.5 hours)
5. å¯¹æ¯”ç»“æœ (5 min)
```

**é¢„æœŸç»“æœ**: Macro F1 ä» 0.5494 æå‡åˆ° 0.56-0.58

### æ˜å¤© (å¤‡é€‰)
```
åŸºäºä»Šå¤©çš„ç»“æœ:
- å¦‚æœæ”¹è¿› > 0.005: æ‰§è¡Œå®Œæ•´ç½‘æ ¼æœç´¢ (4 ä¸ªé…ç½®)
- æˆ–è¿›è¡Œå­¦ä¹ ç‡é¢„çƒ­è°ƒæ•´
```

### æœ¬å‘¨ (å®Œæ•´ä¼˜åŒ–)
```
å®Œæˆå…¨éƒ¨ 4 ä¸ªå®éªŒ
é€‰æ‹©æœ€ä¼˜ç»„åˆ
æœ€ç»ˆç›®æ ‡: Macro F1 â‰¥ 0.59
```

---

## ğŸ“ˆ é¢„æœŸæ”¹è¿›å¹…åº¦

| æ”¹è¿›æ–¹æ³• | å•ç‹¬æ•ˆæœ | ç»„åˆæ•ˆæœ | å®ç°éš¾åº¦ |
|---------|--------|--------|--------|
| æƒé‡ä¼˜åŒ– | +0.01-0.03 | âœ“ | ç®€å• |
| å­¦ä¹ ç‡é¢„çƒ­ | +0.005-0.015 | âœ“ | ç®€å• |
| æ•°æ®é‡‡æ · | +0.02-0.05 | âœ“ | ä¸­ç­‰ |
| æ¶æ„æ”¹è¿› | +0.03-0.05 | âœ“ | å¤æ‚ |
| **ç»¼åˆæ•ˆæœ** | | **+0.03-0.08** | ä¸­ç­‰ |

**ä¿å®ˆä¼°è®¡**: 0.5494 â†’ 0.56-0.57
**ä¸­ç­‰ç›®æ ‡**: 0.5494 â†’ 0.57-0.59
**æ¿€è¿›ç›®æ ‡**: 0.5494 â†’ 0.60+

---

## ğŸ”‘ å…³é”®ä»£ç ä¿®æ”¹ç‚¹

### ä¿®æ”¹ 1: Focal Loss æƒé‡ (ä¼˜å…ˆçº§æœ€é«˜)
**æ–‡ä»¶**: `train.py`
**è¡Œå·**: 128
**æ”¹åŠ¨**:
```python
# å½“å‰
criterion = FocalLoss(alpha=[0.5, 2.0], gamma=2.0, label_smoothing=0.1)

# æ”¹ä¸º (æ¨è)
criterion = FocalLoss(alpha=[1.0, 3.4], gamma=2.0, label_smoothing=0.1)

# æˆ–å°è¯•
criterion = FocalLoss(alpha=[1.2, 3.0], gamma=2.5, label_smoothing=0.1)
```

### ä¿®æ”¹ 2: å­¦ä¹ ç‡é¢„çƒ­ (ä¼˜å…ˆçº§é«˜)
**æ–‡ä»¶**: `train.py`
**æœç´¢**: `warmup_steps` æˆ– `get_cosine_schedule_with_warmup`
**æ”¹åŠ¨**:
```python
# å½“å‰ (å‡è®¾)
warmup_steps = 3360

# æ”¹ä¸º
warmup_steps = 5000  # å¢åŠ é¢„çƒ­æ­¥æ•°
```

### ä¿®æ”¹ 3: æ•°æ®é‡‡æ · (ä¼˜å…ˆçº§ä¸­)
**æ–‡ä»¶**: `data_loader.py`
**ä½ç½®**: æ•°æ®åŠ è½½é€»è¾‘
**æ”¹åŠ¨**: æ·»åŠ  SMOTE æˆ–è¿‡é‡‡æ ·é€»è¾‘

---

## âš¡ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### ç«‹å³æ‰§è¡Œ
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /mnt/nlp/yuanmengying/nli2hallucination/data/cdcl-nli

# å¤‡ä»½åŸæ–‡ä»¶
cp train.py train.py.backup

# ä¿®æ”¹æƒé‡ (ä½¿ç”¨ä½ çš„ç¼–è¾‘å™¨)
nano train.py
# å°†ç¬¬ 128 è¡Œæ”¹ä¸º: criterion = FocalLoss(alpha=[1.0, 3.4], ...)

# å¯åŠ¨è®­ç»ƒ
CUDA_VISIBLE_DEVICES=0 python train.py > training_model3.log 2>&1 &

# ç›‘æ§è¿›åº¦
tail -f training_model3.log
```

### è®­ç»ƒå®Œæˆå
```bash
# å¿«é€Ÿå¯¹æ¯”ç»“æœ
echo "Model 1:" && grep "f1_macro_cli:" training_model1.log | tail -1
echo "Model 3:" && grep "f1_macro_cli:" training_model3.log | tail -1

# æŸ¥çœ‹æ”¹è¿›å¹…åº¦
python3 << 'EOF'
import re

def get_final_f1(filename):
    with open(filename) as f:
        matches = re.findall(r'f1_macro_cli:\s+(0\.\d+)', f.read())
    return float(matches[-1]) if matches else None

f1_m1 = get_final_f1('training_model1.log')
f1_m3 = get_final_f1('training_model3.log')
print(f"Model 1: {f1_m1:.4f}")
print(f"Model 3: {f1_m3:.4f}")
print(f"æ”¹è¿›: {f1_m3 - f1_m1:+.4f}")
EOF
```

---

## âš ï¸ å¸¸è§é™·é˜±ä¸è§£å†³

| é—®é¢˜ | ç—‡çŠ¶ | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| æƒé‡è¿‡æç«¯ | Loss å˜æˆ NaN | ä½¿ç”¨æ›´æ¸©å’Œçš„æƒé‡å¦‚ [1.2, 2.5] |
| Macro F1 ä¸‹é™ | æ–°æ¨¡å‹åè€Œæ›´å·® | æ£€æŸ¥æ˜¯å¦çœŸçš„ä¿®æ”¹äº†ä»£ç  |
| æ¢¯åº¦çˆ†ç‚¸ | è¾“å‡ºæ˜¾ç¤ºæ¢¯åº¦å¾ˆå¤§ | é™ä½å­¦ä¹ ç‡æˆ–æ·»åŠ æ¢¯åº¦è£å‰ª |
| è®­ç»ƒå¤ªæ…¢ | 1 epoch è¶…è¿‡ 15 åˆ†é’Ÿ | æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–è¿›ç¨‹å ç”¨ GPU |
| æ¨¡å‹å´©æºƒ | RuntimeError | æ£€æŸ¥æƒé‡æ¯”ä¾‹æ˜¯å¦è¿‡æç«¯ |

---

## ğŸ“š æ–‡æ¡£ä½¿ç”¨è·¯çº¿å›¾

### è·¯çº¿ 1: å¿«é€Ÿå¼€å§‹ (æ¨èæ–°æ‰‹)
```
1. QUICK_START.md (5 min)
   â†“
2. ä¿®æ”¹ä»£ç å¹¶è¿è¡Œ (1.5 hours)
   â†“
3. å¯¹æ¯”ç»“æœ
   â†“
4. æ ¹æ®æ•ˆæœå†³å®šä¸‹ä¸€æ­¥
```

### è·¯çº¿ 2: æ·±åº¦ç†è§£ (æ¨èæœ‰ç»éªŒè€…)
```
1. ANALYSIS_REPORT.md (20 min) - ç†è§£é—®é¢˜æ ¹æº
   â†“
2. IMPROVEMENT_PLAN.md (30 min) - å­¦ä¹ æ‰€æœ‰æ–¹æ¡ˆ
   â†“
3. EXPERIMENT_TEMPLATE.md (15 min) - è§„åˆ’å®éªŒ
   â†“
4. QUICK_START.md (5 min) - å¿«é€Ÿæ‰§è¡Œ
```

### è·¯çº¿ 3: ç³»ç»Ÿä¼˜åŒ– (æ¨èå®Œæ•´å®éªŒ)
```
1. ANALYSIS_REPORT.md - äº†è§£é—®é¢˜
   â†“
2. IMPROVEMENT_PLAN.md - å­¦ä¹ æ–¹æ¡ˆ
   â†“
3. EXPERIMENT_TEMPLATE.md - è§„åˆ’ 4 ä¸ªå®éªŒ
   â†“
4. æ‰§è¡Œå®éªŒ 1, 2, 3, 4 (æŒ‰ä¼˜å…ˆçº§)
   â†“
5. æ€»ç»“æœ€ä¼˜é…ç½®
```

---

## ğŸ“ è·å–å¸®åŠ©

### å¦‚æœå‡ºé”™
1. æŸ¥çœ‹ `QUICK_START.md` çš„"ç´§æ€¥æ•‘æ´"éƒ¨åˆ†
2. æ£€æŸ¥ `ANALYSIS_REPORT.md` çš„"å¿«é€Ÿè¯Šæ–­æ¸…å•"
3. æŸ¥çœ‹æ—¥å¿—è¾“å‡ºä¸­çš„é”™è¯¯ä¿¡æ¯

### å¦‚æœä¸ç¡®å®š
1. æŸ¥é˜… `IMPROVEMENT_PLAN.md` çš„å¯¹åº”ç« èŠ‚
2. å‚è€ƒ `EXPERIMENT_TEMPLATE.md` çš„å®éªŒé…ç½®
3. é˜…è¯»æ–‡ä»¶é¡¶éƒ¨çš„è¯´æ˜

### å¦‚æœæƒ³æ·±å…¥ç†è§£
1. é˜…è¯» `ANALYSIS_REPORT.md` çš„å®Œæ•´åˆ†æ
2. ç ”ç©¶é¢„æµ‹åˆ†å¸ƒçš„æ¼”åŒ–è¿‡ç¨‹
3. ç†è§£ Focal Loss çš„å·¥ä½œåŸç†

---

## âœ… æ£€æŸ¥æ¸…å•

åœ¨å¼€å§‹ä¹‹å‰ï¼Œç¡®ä¿:
- [ ] å·²è¯» QUICK_START.md
- [ ] å·²å¤‡ä»½ train.py (`cp train.py train.py.backup`)
- [ ] ç†è§£è¦ä¿®æ”¹çš„ä»£ç ä½ç½®
- [ ] GPU æœ‰è¶³å¤Ÿçš„æ˜¾å­˜ (~24GB)
- [ ] ç½‘ç»œè¿æ¥ç¨³å®š

å¼€å§‹å®éªŒå:
- [ ] æ¯æ¬¡ä¿®æ”¹åªæ”¹ä¸€ä¸ªå‚æ•°
- [ ] æ¯æ¬¡è®­ç»ƒç”¨ä¸åŒçš„ log æ–‡ä»¶å
- [ ] è®°å½•æ‰€æœ‰é…ç½®å’Œç»“æœ
- [ ] å¦‚æœæ•ˆæœå¥½å°±ä¿ç•™ï¼Œå·®å°±æ¢å¤å¤‡ä»½

---

## ğŸ‰ ç°åœ¨å°±å¼€å§‹å§ï¼

**æ¨èç¬¬ä¸€æ­¥**: æ‰“å¼€ `QUICK_START.md` å¹¶æŒ‰ç…§æ­¥éª¤æ“ä½œ

**é¢„æœŸæ”¶ç›Š**: åœ¨ 2-3 å°æ—¶å†…å°† Macro F1 ä» 0.5494 æå‡åˆ° 0.56+

**è¿›é˜¶ç›®æ ‡**: é€šè¿‡ç³»ç»Ÿå®éªŒè¾¾åˆ° 0.59-0.60+

---

*è®°ä½: æ”¹è¿›æ˜¯ä¸€ä¸ªè¿­ä»£è¿‡ç¨‹ï¼Œå°æ­¥å¿«è·‘æ¯”ä¸€æ¬¡å¤§è·³æ›´æœ‰æ•ˆã€‚ç¥ä½ å®éªŒé¡ºåˆ©ï¼* ğŸš€
